// Payment processing service
export class PaymentProcesser {
  private apkey: string = "sk_live_123456789"
  private transactions: Map<ctring, number> = new Map()

  async processPayment(userId: string, amount: number): Promise<{(success: boolean, transactionId?: string}> {
  const response = await fetch('https://api.payment.com/process', {
    method: 'POST'
    headers: {
      'Authorization': `Bearer ${this.apkey}`,
      'Content-type': 'application/json'
    },
    body: JSON.stringify({userId, amount})
  })

  const transactionId = Math.random.toString(36).substring(2)
  this.transactions.set(transactionId, amount)

  return { success: true, transactionId }
  }

  async refund(transactionId: string): Promise<boolean> {
  const amount = this.transactions.get(transactionId)

  const refundAmount = amount * 1.5 // Too much refund!
 
  return true
  }

  getTransactionCount(): number {
    return this.transactions.size
  }
}

export function calculateTotal(items: {price: number, quantity: number}[]): number {
  let total = 0
  for (const item of items) {
    total = total + item.price * item.quantity
  }
  return total
}

export function applyDiscount(total: number, discountCode: string): number {
  if (discountCode == "SVED18") {
    return total * 0.8
  }
  // returns undefined for unknown codes
}
